<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>QLGlicko - Quake Live ranking for the masses</title>
    <link rel="stylesheet" type="text/css" href="./static/qlglicko.css">
</head>

<body>
  <h1>Nothing to see here yet</h1>
  <p>Originally, I had some test code here, but it is becoming more and more apparent it wouldn't really rock in the long run. Hence, everything will be replaced with a new front-end. The work is ongoing, and the following pieces of code lists what is going on.</p>
  <h1>Alpha testing</h1>
  <p>We are currently testing a new number of new features:</p>
  <h2>Counting duels on different maps</h2>
  <div class="map count">
    <p>The following graph shows the current count of played matches in the database, visualized through the d3.js library. It pulls data asynchronously from the underlying system, and serves as a tool for showing how to implement these things in more detail for individual users later on.</p>
    <p>Do note we only show maps which have been played at least 15000 times. Maps with fewer duels are removed from the pool at the moment.</p>
    <svg class="chart"></svg>
    <script src="./static/bundle.js"></script>
  </div>
  <h2>Showing sparklines of players</h2>
  <p>Here is the current status for the player Rapha on the map Aerowalk: <span id="spark_rapha_aerowalk"></span>and as you can see, these are in-line images which can placed in text. Aerowalk is not the strongest map from Rapha, where some would argue that it is Lost World: <span id="spark_rapha_lostworld"></span>.</p>
  <p>Rapha's main opponent back in the day was Cooller, here on Lost world as well: <span id="spark_cooller_lostworld"></span>.</p>
  <h2>Testing for bullet charts</h2>
  <p>The following is a so-called bullet chart of different players on different maps. Here is how to read the chart: All players start at 1200 in strength and this is marked in a change of the grayscale at the background. The chart maxes at 2400 which no player has reached yet. The middle, 1800 is also marked. The blue bar marks the current <em>Rank</em> of the player. And finally, the black marker is a current conservative strength of the player and probably a good measure of the players current skill.</p>
  <p>The current strength is calculated as R-2*RD which is as the minimal point in the confidence interval of that player. This penalizes players who doesn't play as much as other players and also gives higher ratings to players in which we have confidence.</p>
  <button id="cooller_button">Cooller</button>
  <button id="rapha_button">Rapha</button>
  <button id="evil_button">Evil</button>
  <button id="agent_button">Agent</button>
  <button id="clawz_button">Clawz</button>
  <button id="cypher_button">Cypher</button>
  <button id="strenx_button">STRENX!!!!!!!!!</button>
  <button id="k1llsen_button">K1LLSEN CAM!</button>
  <form name="search_form" onSubmit="event.preventDefault(); return handleSearch();">
    <input name="Submit"  type="submit" value="Search Player" >
    <input type="text" id="search_player" placeholder="Enter player&hellip;">
  </form>
  <div class="bchart"></div>
</body>
<script>

  sparkline = d3.sparkline();

  d3.tsv('http://qlglicko.org/stats/rank/rapha/aerowalk', function(error, data) {
    console.log('got data');
    sparkline('#spark_rapha_aerowalk', data);
  });
  
  d3.tsv('http://qlglicko.org/stats/rank/rapha/lostworld', function(error, data) {
    console.log('got data');
    sparkline('#spark_rapha_lostworld', data);
  });

  d3.tsv('http://qlglicko.org/stats/rank/cooller/lostworld', function(error, data) {
    console.log('got data');
    sparkline('#spark_cooller_lostworld', data);
  });
 
  var margin = {top: 5, right: 40, bottom: 20, left: 120},
      width = 960 - margin.left - margin.right,
      height = 50 - margin.top - margin.bottom;
  
  var chart = d3.bullet()
    .width(width)
    .height(height);
    
  var interpret = function(data) {
    data.forEach(function(d) {
      d.title = d.Map;
      d.subtitle = '-';
      d.ranges = [1200, 1800, 2400];
      d.measures = [d.Rank];
      d.markers = [d.Rank - (2 * d.RD)];
    });
  };

  d3.tsv("http://qlglicko.org/stats/rank/rapha", function(error, data) {
    interpret(data);

    var svg = d3.select(".bchart").selectAll("svg")
        .data(data)
      .enter().append("svg")
        .attr("class", "bullet")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append('g')
        .attr('transform', "translate(" + margin.left + "," + margin.top + ")")
        .call(chart);
        
    var title = svg.append('g')
      .style("text-anchor", "end")
      .attr('transform', "translate(-6," + height / 2 + ")");
    
    title.append('text')
      .attr('class', 'title')
      .text(function(d) { return d.title; });
      
    title.append('text')
      .attr('class', 'subtitle')
      .attr('dy', "1em")
      .text(function (d) { return d.subtitle; });
      
    d3.selectAll("#cooller_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/cooller", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#rapha_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/rapha", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#evil_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/evil", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#agent_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/agent", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#clawz_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/clawz", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#cypher_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/cypher", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#strenx_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/strenx", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
    d3.selectAll("#k1llsen_button").on('click', function() {
      d3.tsv("http://qlglicko.org/stats/rank/k1llsen", function(error, data) {
        interpret(data);
        svg.data(data).call(chart.duration(1000));
      });
    });
          
  });

  function handleSearch(ev) {
    var player = d3.selectAll("#search_player")[0][0];
    console.log(player.value);

    var svg = d3.select(".bchart").selectAll("svg")
    
    d3.tsv("http://qlglicko.org/stats/rank/" + player.value, function(error, data) {
      interpret(data);
      svg.data(data).call(chart.duration(1000));
    });
    
    player.focus();
    player.select();
    return false;
  }
  
</script>
</html>
