<html>
<head>
<style type="text/css">
thead {
	color: #000;
	font-size: 12px;
	font-weight: bold;
	line-height: 18px;
	padding: 9px 24px;
	background-color:#f8f8f8;
}

caption {
	color: #000;
	font-size: 18px;
	font-weight: bold;
}

table {
	border: 1px;
}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="/static/jquery.sparkline.min.js"></script>
<title>Testing</title>
</head>
<body>
<h1>Rankings</h1>
<form>
      <fieldset>
        <legend>Player Input</legend>
        <p>
          <label>Player</label>
          <input type = "text"
                 id = "player_to_add"
                 value = "" />
        </p>
        <button type = "button" id = "add">Add</button>
      </fieldset>
     </form>
<div id="maps">
</div>
<div class="template-map" style="display:none">
<table>
  <caption class="map-header"></caption>
  <thead>
    <tr><td>Player Name</td><td>Rank</td><td>Match Streak</td><td>Summary</td></tr>
  </thead>
  <tbody class="players">
  </tbody>
</table>
</div>
<table style="display:none">
<tr class="template-player" style="display:none">
<td class="name"></td>
<td class="rank"></td>
<td><span class="streak"></span></td>
<td><span class="sparkline"></span></td>
</tr>
</table>
<script type="text/javascript">
  create = function(map) {
    if ($('#' + map).length == 0) {
      var clone = $('.template-map').clone();
      clone.find('.map-header').text(map);
      clone.attr('id', map);
      clone.removeClass('template-map');
      $('#maps').append(clone.show())
    }
  };

  add_player = function(player, data) {
    $.each(data, function(map, values) {
      create(map);
      
      var clone = $('.template-player').clone();
      clone.removeClass('template-player');
      clone.attr('id', player + '-' + map);
      clone.find('.name').text(player);
      clone.find('.rank').text(values['rank']);
      var r = values['rank'];
      var rd = values['rank_deviation'];
      $('#' + map).find('.players').append(clone.show());
      clone.find('.sparkline').sparkline([0, r - 2*rd, r - rd, r, r + rd, r + 2*rd, 3000],
        { type: 'box', raw: true, width: '140px' } );
      clone.find('.streak').sparkline(values['streak'],
        { type: 'tristate' } );
      
    });
  };
  
  $(document).ready(function() {
    $('#add').click(function() {
      var player = $('#player_to_add')[0].value;
      $.getJSON('/player/' + player, function(data) {
        add_player(player, data);
      });
    });
  });
</script>
</body>
</html>
